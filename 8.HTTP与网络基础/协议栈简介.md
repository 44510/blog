TCP/IP协议栈

外网的连接，无论是以太网、WIFI、GPRS，都是基于一定的协议基础方可实现通讯，目前通用的协议是TCP/IP协议栈。

　　那么就有人要问了，TCP/IP协议、UDP协议和HTTP协议有什么区别呢？通过下面一个比喻相信你就不难理解了（增加了MQTT协议）。

  我们来假设客户端和服务器是两种城市，其中客户端城市比较多，服务器城市就一个，这些城市各有一个门，现在这些客户端城市需要向服务器城市发送货物，那么就需要在这两个城市之间建立一条路，这条路就是TCP/IP，连接两个城市的大门，这条路建立成功后，只要两边的大门都在开着，那么这条路就是畅通的。

  为了货物传输方便，我们在这条路上建立两个不同方向的长传送带（类似于我们所说的TCP透传模式），传送带两端都需要人员照看着，当客户端城市向服务器城市发送货物的时候，这边发货人员直接将这个货物丢在这个传送带上，货物会自动传送到服务器城市去，服务器城市人员收到货物后，就去总部报备这是他接收的那个城市发来的货物。

   但是这样有一个弊端，发送货物的城市对发出去的东西只管丢在传送带上，货物能否到达目的地，中途会不会掉了谁都不知道，这就出现了我们所说的丢包，而且这样需要很多人员看管，这年头人工费高啊。

  为了确保货物安全性，减少成本开支，提高人员使用率，城市之间商量决定，拆掉了传送带，服务器城市只要一个收货人，发货城市需要将货物用大木箱打包好送过来，交由收货人签收，然后发货人再回去复命，跟老板说货物已经收到了，由于只有一个收货人，为了区分货物是由哪个城市发来的，发货人员需要打包时候标明货物信息（HTTP打包），同样发货方也会收到收货方的收货信息（HTTP验证包）。因为送货路程是一定的，送货人员跑一个来回时间知道，如果一定时间内送货人没有回来，说明送货人员出意外了，可能路上遇到哪个美女跟别人跑了，但是发货的老板要保证信誉呀，万一对方没有收到货不是要砸牌子啊，所以吃点亏，再派个人送一次呗（防止丢包，数据补发）。

  由于货物传输越来越多，打包用大木箱太麻烦，也很笨重，送货人员和收货人员都需要是壮汉才搬得动，这年头壮汉不好找，而且货物类型多的时候更加麻烦，为了简化工作量，双方再次协商，采用塑料袋或者纸箱打包，把不必要的东西全部删掉，统一了收发货模式，防止货物收到却没有收到验证信息而不停发货，限制了发货次数（MQTT）。

  是不是少了UDP的解释？别着急，理解以上这些，UDP就很容易了。

  UDP与TCP/IP是相对应的，都是协议栈，但是却是两种不同的方式，比如那两个城市间，TCP是修的路，而UDP协议栈是不需要修路的，发货方只需要填好发货信息，确认好收货人姓名和地址后，就把送货人扔出大门，让他自己去寻找道路，把货送到收货人手中。这么不负责任的表现，造成的后果就是可靠性很低，信誉不好，货物容易丢失，而且较大的货物，贵重物品就很难发货了。

  通过以上比喻，我想你对所谓的UDP、TCP、HTTP和MQTT有了一定的理解了，剩下的就是慢慢去理解他们之间的详细信息。TCP/IP是基础，TCP透传、HTTP和MQTT都是建立在这个的基础上的。而UDP目前由于可靠性的问题，已经很少有人再去使用。

  我们之前说的以太网、WIFI、GPRS都可以走上述协议， TCP/IP协议栈是最基本的，基本上都会支持这个类型的数据，而UDP协议栈可能有些模块就不支持了。在实际应用中，可以将这些协议集成为协议库，使用起来方便快捷。
