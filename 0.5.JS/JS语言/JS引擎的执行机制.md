# JS 引擎的执行机制

1. JS是单线程语言；
2. JS的Event Loop是JS的执行机制。



###  JS为什么是单线程的？

> 如果现在有2个进程，process1 process2，由于是多进程的JS，所以他们对同一个dom，同时进行操作。process1 删除了该dom，而process2 编辑了该dom，同时下达2个矛盾的命令，浏览器究竟该如何执行呢？，

**目的就是为了避免出现自相矛盾的操作。**



###  JS为什么需要异步？

> 如果JS中不存在异步，只能自上而下执行，如果上一行解析时间很长，那么下面的代码就会被阻塞。对于用户而言，阻塞就意味着"卡死"，这样就导致了很差的用户体验。





### JS单线程又是如何实现异步的呢？

> 是通过的事件循环(event loop)，理解了event loop机制，就理解了JS的执行机制。





## Event Loop

JS里的一种分类方式，就是将任务分为：同步任务和异步任务。

按照这种分类方式:JS的执行机制是：

- 首先判断JS是同步还是异步，同步就进入主进程，异步就进入event table
- **异步任务**在event table中注册函数，当满足触发条件后，被推入event queue
- 同步任务进入主线程后一直执行，直到主线程空闲时，才会去event queue中查看是否有可执行的异步任务，如果有就推入主进程中

以上三步循环执行，这就是event loop。



### 异步任务

- setTimeout/setInterval

  ```
  setTimeout(function(){
      console.log('执行了');
   },3000);    
  准确的解释是：3秒后，setTimeout里的函数被会推入event queue，而event queue(事件队列)里的任务，只有在主线程空闲时才会执行。
  如果主线程执行内容很多，执行时间超过3秒，比如执行了10秒，那么这个函数只能10秒后执行了。
  ```

- 事件处理

- ajax请求

- 图片加载onload

- .then 函数里面是异步任务

- script脚本下载