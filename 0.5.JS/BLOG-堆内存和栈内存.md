---
title: 对内存和栈内存
date: 2018-6-6
tags:
  - js内存
  - 堆
  - 栈
---

- 堆（heap），堆是堆内存的简称。
- 栈（stack），栈是栈内存的简称。

说到堆栈，我们讲的就是内存的使用和分配了，没有寄存器的事，也没有硬盘的事。

栈，线性结构，后进先出，便于管理。堆，一个混沌，杂乱无章，方便存储和开辟内存空间。

## 栈内存和堆内存

我们首先记住一句话：JS 中，所有的**变量**都是保存在**栈内存**中的。

### 堆内存

堆是动态分配内存，内存大小不一，也不会自动释放。

- JS 中其他类型的数据被称为**引用类型的数据**（如**对象、数组、函数**等），它们是通过拷贝和 new 出来的，这样的数据存储于堆中。
- **引用类型的数据的地址指针是存储于栈中的**，当我们想要访问引用类型的值的时候，需要**先从栈中获得对象的地址指针，然后，在通过地址指针找到堆中的所需要的数据**。

### 栈内存

栈是自动分配相对固定大小的内存空间，并由系统自动释放。

JS 的基本类型就 5 种，Undefined、Null、不是 new 出来的布尔、数字和字符串，它们**都是直接按值存储在栈中的**，每种类型的数据占用的内存空间的大小是确定的，并由系统**自动分配和自动释放**。这样带来的好处就是，内存可以及时得到回收，相对于堆来说，更加容易管理内存空间。

然后来看看下面的区别。

### 基本数据类型

**基本数据类型的值，直接保存在栈内存中**。值与值之间是独立存在，修改一个变量不会影响其他的变量。

### 引用数据类型

**对象是保存到堆内存中的**。每创建一个新的对象，就会在堆内存中开辟出一个新的空间，而**变量保存了对象的内存地址**（对象的引用）。如果两个变量保存了同一个对象的引用，当一个通过一个变量修改属性时，另一个也会受到影响。

## 堆和栈的区别 | 栈和堆具体怎么存储

栈内存中的变量一般都是**已知大小或者有范围上限的**，算作一种简单存储。

而堆内存存储的**对象类型数据对于大小这方面，一般都是未知的**。个人认为，这也是为什么 null 作为一个 object 类型的变量却存储在栈内存中的原因。

一般来说栈内存线性有序存储，容量小，系统分配效率高。

而堆内存首先要在堆内存新分配存储区域，之后又要把指针存储到栈内存中，效率相对就要低一些了。

## 垃圾回收时栈和堆的区别

垃圾回收方面，**栈内存变量基本上用完就回收了**，而推内存中的变量因为存在很多不确定的引用，只有**当所有调用的变量全部销毁之后才能回收**。
