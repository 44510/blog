
# traverse介绍

这里只需要了解基本的语法，对着ast的json进行开发就行了，很类似dom树；

## traverse可以有哪些选项

1. 访问的方式1，自己遍历所有的节点，然后判断节点类型，目标节点；
   1. enter
   2. exit
2. 直接指定遍历某些类型，这些类型可以通过；
   1. Program；
   2. Identifier；
   3. ClassBody；
   4. FunctionDeclaration；
   5. ...

## path属性

这个主要包括当前节点的一些信息，不同的几点，这里的path的属性也不一样，具体可以看一下ast打印的结果。

```js

path {
    // 属性：
    node // 当前 AST 节点
    parent // 父 AST 节点
    parentPath // 父 AST 节点的 path
    scope // 作用域
    hub // 可以通过 path.hub.file 拿到最外层 File 对象， path.hub.getScope 拿到最外层作用域，path.hub.getCode 拿到源码字符串
    container // 当前 AST 节点所在的父节点属性的属性值
    key // 当前 AST 节点所在父节点属性的属性名或所在数组的下标
    listKey // 当前 AST 节点所在父节点属性的属性值为数组时 listkey 为该属性名，否则为 undefined
}
```

## 理解demo1

```js
  traverse(ast, {
    Program(path) {
      const { node } = path;

      returnNode = node.body[0].expression

      importNodes = findImportNodes(node);
    },
    Identifier(path) {
      const { node } = path;
      if (node.name === 'styles') {
        node.name = stylesName;
      }
    },
  });
```

### 访问者模式 Visitor

- 访问者模式 Visitor 对于某个对象或者一组对象，不同的访问者，产生的结果不同，执行操作也不同
- Visitor 的对象定义了用于 AST 中获取具体节点的方法
- Visitor 上挂载以节点 type 命名的方法，当遍历 AST 的时候，如果匹配上 type，就会执行对应的方法

### path对象

- node 当前 AST 节点
- parent 父 AST 节点
- parentPath 父AST节点的路径
- scope 作用域
- get(key) 获取某个属性的 path
- **set(key, node)**设置某个属性
- is类型(opts) 判断当前节点是否是某个类型
- find(callback) 从当前节点一直向上找到根节点(包括自己)
- **findParent(callback)**从当前节点一直向上找到根节点(不包括自己)
- insertBefore(nodes) 在之前插入节点
- insertAfter(nodes) 在之后插入节点
- replaceWith(replacement) 用某个节点替换当前节点
- replaceWithMultiple(nodes) 用多个节点替换当前节点
- replaceWithSourceString(replacement) 把源代码转成AST节点再替换当前节点
- remove() 删除当前节点
- **traverse(visitor, state)**遍历当前节点的子节点,第1个参数是节点，第2个参数是用- 来传递数据的状态
- skip() 跳过当前节点子节点的遍历
- stop() 结束所有的遍历
- getSibling(key) 获取某个下标的兄弟节点
- getNextSibling() 获取下一个兄弟节点
- **getPrevSibling()** 获取上一个兄弟节点
- getAllPrevSiblings() 获取之前的所有兄弟节点
- getAllNextSiblings() 获取之后的所有兄弟节点

### scope环境

- **scope.bindings**当前作用域内声明所有变量
- **scope.path**生成作用域的节点对应的路径
- **scope.references**所有的变量引用的路径
- getAllBindings() 获取从当前作用域一直到根作用域的集合
- **getBinding(name)**从当前作用域到根使用域查找变量
- getOwnBinding(name) 在当前作用域查找变量
- parentHasBinding(name, noGlobals) 从当前父作用域到根使用域查找变量
- removeBinding(name) 删除变量
- hasBinding(name, noGlobals) 判断是否包含变量
- **moveBindingTo(name, scope)**把当前作用域的变量移动到其它作用域中
- generateUid(name) 生成作用域中的唯一变量名,如果变量名被占用就在前面加下划线
- scope.dump() 打印自底向上的 作用域与变量信息到控制台

## 介绍一下traverse的常用方法

## 如何修改节点的参数

## 参考文章

<https://juejin.cn/post/7113800415057018894>
