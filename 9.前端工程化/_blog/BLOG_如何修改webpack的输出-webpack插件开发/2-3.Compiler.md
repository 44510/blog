## [compiler 钩子](https://webpack.docschina.org/api/compiler-hooks/)

1. [compiler 钩子](https://webpack.docschina.org/api/compiler-hooks/)；
2. Compiler 模块是 webpack 的主要引擎，它通过 CLI 或者 Node API 传递的**所有选项\*\***创建出一个 compilation 实例\*\*。
3. 它扩展（extends）自 Tapable 类，**用来注册和调用插件**。 **大多数面向用户的插件会首先在 Compiler 上注册**。
4. 具体就是**依次调用插件的 apply 方法**，并将 compiler 对象 (包含 webpack 的各种配置信息) 传进去供 plugin 使用，**compiler 包含整个构建流程的全部钩子，通过它可以把控整个 webpack 构建周期**。
5. 在运行期间 compiler **会根据 webpack 不同阶段触发的各种事件钩子**，执行插件附加/绑定在 hook 上的函数。
6. **compiler 只是负责维持生命周期运行的功能**，所有的加载、打包和写入工作，都被委托到注册过的插件上了。
7. webpack 使用 WebpackOptionsDefaulter 和 WebpackOptionsApply 来配置 Compiler 实例以及所有内置插件。
8. Compiler 类实例化并注册 plugins 后，**若 webpack 函数接收了回调 callback，会执行 compiler.run()方法**，webpack 即刻开启编译之旅。如果未指定 callback 回调，则需要用户自己调用 run 方法来启动编译。

此模块会暴露在 webpack.Compiler，可以直接通过这种方式使用。

查看 webpack 的源码。

### Compiler

1. Compiler 类(./lib/Compiler.js)：webpack 的主要引擎，扩展自 Tapable。
2. **webpack 从执行到结束，Compiler 只会实例化一次**。生成的 compiler 对象记录了 webpack 当前运行环境的完整的信息，该对象是全局唯一的，**插件可以通过它获取到 webpack config 信息，如 entry、output、loaders 等配置**。
   1. 这里的插件的 config 信息，会合并插件初始化的时候的参数；
3. Compiler 有几个重要的方法，watch 和 run 是启动/执行 webpack 构建的函数，而 compile 是负责编译的。 它触发 compile 钩子**并实例化了一个 compilation**，再触发自己的 make 钩子把 compilation 对象作为参数传过去。

4. 在 compiler 类中，提供了三种类型的内置解析器：
   1. normal: 通过绝对或相对路径解析模块。
   2. context: 在给定的上下文中解析模块。
   3. loader: 解析 webpack loader。
   4. **请注意，resolve 配置会影响 normal 解析器和 context 解析器**，**而“ resolveLoader 用于修改 loader 解析器**。

#### 监听(watching)

1. Compiler 支持可以监控文件系统的 监听(watching) 机制，并且在文件修改时重新编译。
2. 当处于监听模式(watch mode)时， compiler 会触发诸如 watchRun, watchClose 和 invalid 等额外的事件。

webpack 插件开发主要基于 Tapable 的插件机制提供丰富的自定义 API 和生命周期事件，可以控制 webpack 编译的每个流程

Compiler 包含 webpack 环境的所有配置信息

Compilation 包含整个编译过程中所有环节对应的方法

## Compiler Hooks

Compiler 编译器模块是创建编译实例的主引擎。大多数面向用户的插件都首先在 Compiler 上注册。

1. run AsyncSeriesHook 在编译器开始读取记录前执行
2. compile SyncHook 在一个新的 compilation 创建之前执行
3. compilation SyncHook 在一次 compilation 创建后执行插件
4. make AsyncParallelHook **完成一次编译之前执行**
5. emit AsyncSeriesHook 在生成文件到 output 目录之前执行，回调参数： compilation
6. afterEmit AsyncSeriesHook 在生成文件到 output 目录之后执行
7. assetEmitted AsyncSeriesHook 生成文件的时候执行，提供访问产出文件信息的入口，回调参数：file，info
8. done AsyncSeriesHook 一次编译完成后执行，回调参数：stats
