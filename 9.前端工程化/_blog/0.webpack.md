
## webpack介绍

webpack 是一个用于现代 JavaScript 应用程序的 静态模块打包工具。当 webpack 处理应用程序时，它会在内部从一个或多个入口点构建一个 依赖图(dependency graph)，然后将你项目中所需的每一个模块组合成一个或多个 bundles，它们均为静态资源，用于展示你的内容。

**webpack的过程**是通过Compiler控制流程，Compilation专业解析，ModuleFactory生成模块，Parser解析源码，最后通过Template组合模块，输出打包文件的过程。

粗暴版本：**webpack就是打散源码再重组的过程**。

### webpack的基本原理

1. webpack的入口entry，所有的文件都会以此为基础进行构建；
2. 其他相关的文件会由loader处理后，给webpack处理；
3. 一些通用的工作由专门的plugin来处理；
4. 开发服务器dev-server，用来在本地开发；
   1. 本质上是通过分析文件的hash，后使用websocket来将改变通知到浏览器，实现热更新；
5. webpack Loader 作为 webpack 核心能力之一，其基本工作就是将一个文件以字符串的形式读入，再对其进行语法分析和转换后再交给下一环节处理。
   1. 既然是以字符串形式读入，那修改源码就变得非常简单，结合 webpack 在指定 Loader 时的 test 匹配，可以快速定位到指定类型的文件

### webpack4 和 webpack5的差异

1. Tree Shaking(强大)；
2. 压缩代码；
   1. 内部本身就自带 js 压缩功能，他内置了 terser-webpack-plugin 插件，我们不用再下载安装。而且在 mode=“production” 的时候会自动开启 js 压缩功能。
3. 缓存配置；
   1. webpack5 内部内置了 cache 缓存机制。直接配置即可。
4. 输出代码；
   1. webpack5新增属性output.ecmaVersion，可以生成ES5和ES6的代码；
   2. webpack4只能输出es5的代码；

### 看看我们执行 webpack 过程中运行了哪一些钩子

```js
const webpack = require('webpack');
// 我们这里的配置文件是一个函数
const webpackConfig = require('./config/webpack.common.js');

const compiler = webpack(webpackConfig());

// 遍历hooks，添加回调，输出`hookName`
Object.keys(compiler.hooks).forEach(hookName => {
  if (compiler.hooks[hookName].tap) {
    compiler.hooks[hookName].tap('anyString', () => {
      console.log(`run -> ${hookName}`);
    });
  } 
});

// 触发webpack的编译流程
compiler.run();
```
