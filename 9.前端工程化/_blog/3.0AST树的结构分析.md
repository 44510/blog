## AST树的结构分析

AST（Abstract Syntax Tree）抽象语法树。

在计算机科学中，抽象语法树(AST)，或简称**语法树**，是用编程语言编写的**源代码的抽象语法结构的树表示**。

**它以树状的形式表现编程语言的语法结构，树上的每个节点都表示源代码中的一种结构**。

之所以说语法是“抽象”的，**是因为这里的语法并不会表示出真实语法中出现的每个细节**。

### 2. 分析一下AST树的结构，这个是从recast来生成的

1. <https://blog.csdn.net/qq_18470967/article/details/119964180>

### ast的类型

1. Identifier：
   1. 是标识符的意思，变量名、属性名、参数名等各种声明和引用的名字，都是Identifer。
2. Statement：
   1. statement 是语句，它是可以独立执行的单位，比如 break，continue，debugger，return 或者 if 语句、while 语句、for 语句，还有声明语句，表达式语句等。我们写的每一条可以独立执行的代码，都是语句。
   2. 语句末尾一般会加一个分号分隔，或者用换行分隔。
   3. 语句是代码执行的最小单位，可以说，代码是由语句（Statement）构成的。
3. Declaration：
   1. 声明语句是一种特殊的语句，它执行的逻辑是在作用域内声明一个变量、函数、class、import、export 等。
   2. 声明语句用于定义变量，变量声明也是代码中一个基础的部分。
4. Expression：
   1. expression 是表达式，**特点是执行完以后有返回值，这是和语句 (statement) 的区别**。
   2. 有的表达式可以单独执行，符合语句的特点，所以也是语句，比如赋值表达式、数组表达式等，但有的表达式不能单独执行，需要和其他类型的节点组合在一起构成语句。比如匿名函数表达式和匿名 class 表达式单独执行会报错。
   3. **表达式语句解析成 AST 的时候会包裹一层 ExpressionStatement 节点**，代表这个表达式是被当成语句执行的。
5. Class：
   1. class 的语法比较特殊，有专门的 AST 节点来表示。
   2. 整个 class 的内容是 ClassBody，属性是 ClassProperty，方法是ClassMethod（通过 kind 属性来区分是 constructor 还是 method）。
6. Modules：
   1. es module 是语法级别的模块规范，所以也有专门的 AST 节点。
7. Program & Directive：
   1. program 是代表整个程序的节点，它有 body 属性代表程序体，存放 statement 数组，就是具体执行的语句的集合。还有 directives 属性，存放Directive 节点，比如"use strict" 这种指令会使用 Directive 节点表示。
   2. Program 是包裹具体执行语句的节点，而 Directive 则是代码中的指令部分。
8. File & Comment：
   1. babel 的 AST 最外层节点是 File，它有 program、comments、tokens 等属性，分别存放 Program 程序体、注释、token 等，是最外层节点。
   2. 注释分为**块注释和行内注释**，对应 CommentBlock 和 CommentLine 节点。

#### AST 的公共属性

每种 AST 都有自己的属性，但是它们也有一些公共属性：

1. type：AST 节点的类型
2. start、end、loc：start 和 end 代表该节点对应的源码字符串的开始和结束下标，不区分行列。而 loc 属性是一个对象，有 line 和 column 属性分别记录开始和结束行列号。

#### 分析

1. `recast.print(mAst).code`，把ast树转换成代码重新输出；
2. `recast.visit(ast, methods)`；recast遍历整个树的方法(recast.visit)，这里的遍历会走到每个父节点与子节点；
   1. 这一个参数没啥好说的，直接把解析出来的ast传进去就好了；
   2. 在recast遍历ast树的时候，我们只需要拿一个这个ast类型然后在前面加上visit就完事了；
      1. 查看接口：直接翻源代码</Users/qiuwww/code/learn/blog/9.前端工程化/AST抽象语法树/ast-demo-官方示例/node_modules/@babel/types/lib/index.js>；

#### path参数

1. 这里可以直接查看ast的结果；

### 常用的一些方法

1. node.body.body.unshift();
2. path.parentPath

```js
// 1. 替换一个变量的名字
// console.log('traverse path.node:', path.node);
// if (types.isIdentifier(path.node, { name: 'n' })) {
//   path.node.name = 'x';
// }

// // 修改变量名
// if(node.type==='VariableDeclarator'){
//   node.id.name='result';
// }
```

### 参考

1. [JavaScript 常见 AST 梳理](https://blog.csdn.net/weixin_40906515/article/details/118004822)
2. [应用ast抽象语法树修改js函数](https://blog.csdn.net/qq_18470967/article/details/119964180)
3. <https://astexplorer.net/>
4. [手把手带你入门 AST 抽象语法树](https://juejin.cn/post/6844904035271573511)
