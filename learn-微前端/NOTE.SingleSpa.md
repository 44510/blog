# 微前端（Micro Frontends）

1. 方便于使用不同的技术，构建大型项目；
2. 解决微服务中的瓶颈问题：
   1. 解决方案实际上非常明显，采用了多年来为后端服务工作的相同原则：**将前端整体划分为小的 UI 片段**。但 UI 与服务并不十分相似，它是最终用户与产品之间的接口，**应该是一致且无缝的**。更重要的是，在单页面应用时代，整个应用在客户端的浏览器上运行。它们不再是简单的 HTML 文件，相反，它们是复杂的软件，达到了非常复杂的水平。
3. 定义：Micro Frontends 背后的想法是将网站或 Web 应用视为独立团队拥有的功能组合。每个团队都有一个独特的业务或任务领域，做他们关注和专注的事情。团队是跨职能的，从数据库到用户界面开发端到端的功能。

## demo

1. /Users/qiuww/code/lab/micro-frontend-SingleSpa
2. /Users/qiuww/code/learn/blog/微前端/qiankun-demo

## microfrontend 是什么

1. A microfrontend is a microservice that exists within a browser 即微前端是浏览器中存在的微服务。
2. 微前端也是 UI 的一部分，通常由数十个组件组成，而这些组件可以是 React，Vue 和 Angular 等不同框架实现的。
3. 每个微前端项目可以放在不同的 git 存储库中，有自己的 package.json 和构建工具配置。这样每一个微前端项目都有一个独立的构建打包过程和独立的部署。

## 为什么

1. 老项目难维护；
2. 项目臃肿；
3. 技术栈难统一；

### microfrontend 能解决的问题

1. 具有独立运行、独立部署功能，构建部署速度快。
2. 技术栈无关，具有独立开发功能，避免开发冲突，减少协作成本。
3. 旧项目可以作为微前端项目一部分，避免重构。

## 技术选型

### 为什么不选择 iframe

微前端的实现方式不有很多种，包括 iframe、single-spa 等。

iframe 最大的特性就是**提供了浏览器原生的硬隔离方案**，不论是样式隔离、js 隔离这类问题统统都能被完美解决。

但他的**最大问题也在于他的隔离性无法被突破，导致应用间上下文无法被共享，随之带来的开发体验、产品体验的问题**。

1. url 不同步。浏览器刷新 iframe url 状态丢失、后退前进按钮无法使用。
2. UI 不同步，DOM 结构不共享。想象一下屏幕右下角 1/4 的 iframe 里来一个带遮罩层的弹框，同时我们要求这个弹框要浏览器居中显示，还要浏览器 resize 时自动居中.
3. 全局上下文完全隔离，内存变量不共享。iframe 内外系统的通信、数据同步等需求，主应用的 cookie 要透传到根域名都不同的子应用中实现免登效果
4. 慢。每次子应用进入都是一次浏览器上下文重建、资源重新加载的过程

### single-spa

single-spa 使用的主要难点在于：

1. 对于总项目，如何完美兼容各个子项目，做到技术栈无关，并且让用户感觉是一个整体项目。
2. 对于各个子项目，如何减少代码侵入，并且使其具有独立开发、独立运行、独立部署的能力。

#### single-spa 实现原理

**首先对微前端路由进行注册**，**使用 single-spa 充当微前端加载器**，**并作为项目单一入口来接受所有页面 URL 的访问**，根据页面 URL 与微前端的匹配关系，选择加载对应的微前端模块，再由该微前端模块进行路由响应 URL，即微前端模块中路由找到相应的组件，渲染页面内容。

## qiankun

[与前一个差不多，](https://qiankun.umijs.org/zh/guide/tutorial#%E4%B8%BB%E5%BA%94%E7%94%A8)，空了可以配置一下。

1. qiankun 基于 single-spa

## 参考资料

1. [参考文档](https://juejin.cn/post/6844904158349246477)
2. [实施微前端的六种方式](https://segmentfault.com/a/1190000015566927)
3. [qiankun](https://qiankun.umijs.org/zh/guide/getting-started#%E4%B8%BB%E5%BA%94%E7%94%A8)
4. [了解什么是微前端](https://mp.weixin.qq.com/s/awBqvJmqWc7JGxwgB0QQZA)
