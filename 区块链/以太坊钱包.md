# 以太坊钱包

获取用户余额，管理地址和密钥，转账、智能合约调用。以太坊钱包一般不用在本地维护区块链数据，只需要使用JSON-RPC访问。

## 以太坊

和比特币一样，以太坊用户必须向网络支付少量交易费用。这可以使以太坊区块链免受无关紧要或恶意的运算任务干扰，比如分布式拒绝服务（DDoS）攻击或无限循环。 交易的发送者必须在激活的“程序”每一步付款，包括运算和记忆储存。费用通过以太坊自有的有价代币，以太币的形式支付。

1. 要想成为网络中的节点，需要运行一个以太坊客户端。
2. 称以太坊为一个生态系统再合适不过了：核心协议由不同的基础设施、编码和社群支持， 他们共同构成了以太坊项目。
3. 除开发以太坊软件外，要发布新的加密货币和区块链，需要大量的辅助程序努力来组装启动和运行所需要的资源。
4. **以太坊Frontier网络**
5. 于2015年7月30日启动，开发者开始编写智能合约和去中心化应用以部署在以太坊实时网络上。 此外，矿工们开始加入以太坊网络以帮助保障以太坊区块链的安全并从挖矿区块中赚取以太币。 尽管Frontier的发布是以太坊项目的第一个里程碑，开发者们只试图将其作为测试版本， 但结果它比任何人预期得都更有用且可靠，开发者们立即开始建立解决方案，改进以太坊生态系统。

## 以太坊客户端

大部分的用户只需要安装 Mist / 以太坊钱包 就能满足使用需求。

众所周知，日常我们都是在电脑上运行程序，而这些程序都是由CPU执行一系列任务。那么，**在区块链网络上运行各个程序就需要在其每个节点上执行并记录智能合约、交易数据信息等。程序收到节点传递的信息会进行同步，让智能合约保持当前状态一致。**

## 查看在BNB测试网下的某个钱包的交易记录

1. [查看地址](https://testnet.bscscan.com/address/0x9a62272fe2e8f30653bb5ac2c04f702474ac4882)；
2. 可以看到交易主币（BNB），会被记录在Transactions下，交易USDT会被记录在BEP-20 Tokens下；
3. 可以看到即使交易失败也会消耗费用；
4. 大多的正常交易需要消耗的BNB都是0.00021，也就是21000Gwei；
5. 查看USDT的交易消耗需要点进去查看：<https://testnet.bscscan.com/tx/0x624c41e77c781680f514a75228e6a0950bf15d691f279496ecfbf21903afdf67>，消耗的记录是使用的BNB；
6. 交易区块: <https://testnet.bscscan.com/block/28468748>；
   1. 会记录交易的信息，也就是执行的一些函数；
7. 查看某一次的交易信息：<https://testnet.bscscan.com/tx/0x17a14d690205305ed723be959a368ba3838ee61997381a5c4155707ebcd2a61f>；
   1. 可以看到交易的价格，Gas Price为39Gwei，但是被的区块里边的都不一样；
      1.

## [理解以太坊 GAS 燃料和交易手续费](https://learnblockchain.cn/books/geth/part1/gas.html)

1. Gas 中译是：瓦斯、汽油，代表一种可燃气体。 这形象地比喻以太坊的交易手续费计算模式，不同于比特币中直接支付比特币作为转账手续费， 以太坊视为一个去中心化的计算网络，当你发送Token、执行合约、转移以太币或者在此区块上干其他的时候，计算机在处理这笔交易时需要进行计算消耗网络资源，这样你必须支付燃油费购买燃料才能让计算机为你工作。最终燃料费作为手续费支付给矿工。
2. 与比特币不同的是，无论交易成功与否，你都需要为此支付燃料费。这是因为即使交易失败，矿工依旧为此交易进行校验和计算，消耗了资源。同时你也无法在钱包中直接设置支付多少燃料费，因为实际燃料费是矿工根据计算得出的，并记录在包含此交易的区块中。
3. 你可以把 gasUsed 看成是汽车所需多少升燃油。把 gas price 看成是燃油单价。
4. Gwei是以太币的一种计算单位。
   1. 对于汽车，每升汽油6.46元（price），10 升汽油就是64.6元。对于以太坊，每gas是20Gwei(price)，21000 个 gas 就是 20*21000 Gwei= 420000 Gwei= 0.00042 Ether。也就是说本次交易手续为 0.00042 Ether。
5. 这样交易需要消耗多少Gas完全取决于执行完交易中的所有操作指令的累计Gas， 交易执行完成时虚拟机将反馈总消耗Gas量，称之为 gasused。 而你所需支付的手续费等于**gasPrice * gasUsed**。
6. Gas Limit：
   1. 因为手续费等于 gasPrice * gasUsed，用户在转账，特别是执行智能合约时 gasUsed 无法提前预知。 这样存在一个风险，当用户的交易涉及一个恶意的智能合约，该合约执行将消耗无限的燃料， 这样会导致交易方的余额全部消耗（恶意的智能合约有可能是程序Bug，如合约执行陷入一个死循环）。
      1. 你必须支付足够燃料来支付本交易所必要的计算资源。如果交易尚未执行完成，而燃料已用完， 将出现一个 Out of Gas 的错误。
   2. 另外，如果最终 gasUsed 低于 gasLimit，即燃料未用完。则剩余燃料(gasLimit - gasUsed )将在交易后退还给你。
   3. 21000 是标准转账交易的gasUsed。因此一笔标准的转账交易你可以设置 gasLimit 为21000。
7. Gas Price：
   1. 因为你所需要支付的燃料费为燃料单价(gasPrice) * 燃料开销(gasUsed)，**如果你想让交易花费更少， 你能够做的是降低你愿意支付的燃料单价。** 另一方面，降低燃料单价的坏处是交易可能需要等待很长时间才被打包到区块中。
      1. 燃料开销(gasUsed)：这里通常是固定的，或者可能是超出的。
      2. 也就是说，这里的交易的Gas Price是自己设置的，设置的多大多是可以交易的，太少可能交易不成功。
      3. 这是因为交易燃料费将归属于挖出本区块的矿工。当矿工挖矿时，他需要决定哪些交易放入到区块中，可以随机选择交易， 也可以不包含任何交易。为了鼓励让矿工将你的交易放入区块，你会考虑将燃料单价设置得足够诱人，已确保能优先放入区块。
      4. **如果你着急交易，高燃料单价会使得你的交易排在别人前面。 如果不着急，你只需设置一个足够让矿工包含你交易的燃油单价即可**。
      5. 大部分矿工遵循一个简单策略，优先打包本地交易， 将接受到的交易按燃油单价从高到底排列，依次放入区块中直到塞满区块，或者直到低于矿工所设置的燃料单价底限。
      6. 一般情况下：
         1. 高燃料单价为50 GWEI 的交易几乎总能放到下一个区块。
         2. 高燃料单价为22 GWEI 的交易通常会把它放到未来的几个区块中。
         3. 高燃料单价为8 GWEI 的交易通常会在未来几分钟内放入区块。

## 以太币的计算单位

- Kwei(Babbage) = 10**3 Wei
- Mwei(Lovelace) = 10**6 Wei
- Gwei(Shannon) = 10**9 Wei
- Microether(Szabo) = 10**12 Wei
- Milliether(Finney) = 10**15 Wei
- Ether = 10**18 Wei

如`40807178566070000000000 Wei / 10**18` = 40807.17856607eth。

## gas

以太坊在加密货币领域是独一无二的，**原因在于以太币作为加密燃料具有实用价值，通常被称作"gas"。除交易费用外，gas是每个网络请求的中心部分，需要发送者为消费的运算资源付费**。Gas成本是基于请求规模和复杂性的动态计算，乘以现在的gas价格。它作为加密燃料的价值能够增加以太币和以太坊作为一个整体的稳定性和长期需求。

Gas被认为是网络资源/使用的固定成本。想要发送交易的真实成本保持一致，所以不希望gas发行，一般来说货币是不稳定的。

因此我们发行以太币，它的价值会变动，但也会根据以太币来执行gas价格换算。如果以太币价格上升，gas价格换算成以太币会下降，以此来保持gas的真实花费相同。

gas有多个相关词汇：gas成本，gas限制和gas费用。gas背后遵循的原则是使以太坊网络上每个交易或计算成本保持稳定的价值。

## [区块链网络](https://hyperledger-fabric.readthedocs.io/zh_CN/latest/network/network.html)

1. 区块链网络是一个为应用程序提供账本及智能合约（chaincode）服务的技术基础设施。
2. 首先，**智能合约被用来生成交易，接下来这些交易会被分发给网络中的每个节点**，这些交易会被记录在他们的账本副本上并且是不可篡改的。这个应用程序的用户可能是使用客户端应用的终端用户，或者是一个区块链网络的管理员。
3. 在大多数的额情况下，多个组织 会聚集到一起作为一个联盟 来形成一个网络，并且他们的权限是由一套在网络最初配置的时候联盟成员都同意的规则来决定的。并且，网络的规则可以在联盟中的组织同意的情况下随时地被改变，就像当我们讨论 修改规则 概念的时候将要发现的那样。

## 以太坊钱包地址创建过程

1. 使用Secp256k1创建公私钥

## 区块链钱包-安卓版本怎么开发

开发区块链钱包的安卓版本需要以下步骤：

1. 确定钱包的功能和设计：您需要确定钱包的功能，例如**支持哪些加密货币、转账、交易记录等**，并设计用户界面和交互操作。
2. 学习区块链技术：要开发区块链钱包，您需要先了解区块链技术，并学习如何使用相关的开发工具和API。
3. 选择适当的开发工具：您可以使用**Java**或Kotlin开发Android应用程序。您还可以使用一些流行的框架，如React Native、Flutter等。
4. 集成加密货币API：**您需要使用区块链API来与区块链网络进行交互**。例如，如果您支持比特币，您可以使用比特币API来处理转账和交易记录。
5. 测试和发布：在您完成钱包开发后，您需要对其进行测试以确保其稳定性和安全性。一旦测试通过，您可以将钱包发布到Google Play商店或其他应用市场。

需要注意的是，开发区块链钱包需要一定的技术知识和经验，同时也需要考虑到安全性和用户体验。因此，建议您在开发之前进行充分的准备和学习。

## 比特币和以太坊的区别与联系

比特币和以太坊是两种不同的加密货币，它们之间有以下区别和联系：

1. 目的不同：比特币旨在成为一种去中心化的数字货币，而以太坊旨在成为一个分布式计算平台，支持智能合约和去中心化应用程序的开发。

2. 区块链技术不同：比特币使用的是一种叫做“工作量证明”的共识算法，而以太坊使用的是“权益证明”算法。这两种算法有不同的优缺点，例如工作量证明需要大量的计算资源，而权益证明则需要大量的代币来参与验证。

3. 交易速度和费用不同：由于以太坊支持智能合约和去中心化应用程序的开发，因此交易速度和费用相对较低。而比特币的交易速度和费用则较高，主要是因为比特币的区块大小和交易确认时间限制。

4. 市值和流通量不同：截至2021年7月，比特币的市值约为7700亿美元，而以太坊的市值约为3200亿美元。比特币的总发行量为2100万枚，而以太坊则没有总发行量的限制，但每年的发行量有一定的上限。

总的来说，比特币和以太坊都是重要的加密货币，它们在区块链技术、目的、交易速度和费用、市值和流通量等方面存在差异。

### 其他

比特币开发者认为核心区块链不应该具备图灵完备，这样可以有效避免外来攻击和网络堵塞。也正是这种局限性，黑客们一直没办法用脚本语言写一些死循环代码来攻击网络，使比特币网络一直稳定运行。但是，这也使得比特币网络上无法再运行复杂程序。

## [签署以太坊交易](http://cw.hubwiz.com/card/c/web3j/1/3/10/)

## transfer ERC20 / transfer ether

### ETH 和 ERC-20 有什么区别？

**以太 (ETH) 是以太坊区块链和网络的原生代币**，用作验证交易的支付系统。ERC-20 是为以太坊生态系统创建支持智能合约的可替代代币的标准。

我希望您现在知道什么是 ERC20 以及 ETH 和 ERC20 之间的区别。如果任何智能合约想要使用 ERC20 代币，那么它需要相应地遵循一些规则或 ERC 标准。在其他情况下，如果您不遵守规则，将其称为 ERC 20 代币是不合适的。

ERC20是一种基于以太坊网络的代币标准，它定义了代币的基本属性和交互方式。**ERC20代币可以在以太坊网络上进行交易**，但它们与ETH交易的区别在于：

1. **ERC20代币是基于以太坊网络的智能合约**，而**ETH是以太坊网络的本地加密货币**。
2. **ERC20代币的交易需要使用代币交易所或钱包，而ETH可以直接在以太坊网络上进行交易**。
3. ERC20代币的交易费用由代币发行者设置，而ETH交易费用是由矿工设置的。
4. ERC20代币的交易速度可能会受到以太坊网络拥堵的影响，而ETH交易速度通常较快。
5. ERC20代币的价值通常与ETH无关，而是由市场供求关系决定的。

## RawTransaction.createTransaction中的参数gasPrice gasLimit不能为空 不然会报java.lang.NullPointerException错误

## web3j.ethCall

web3j.ethCall方法是用于在以太坊网络上执行智能合约函数的方法。该方法的主要用途是查询智能合约状态或执行函数，而无需发送交易或改变智能合约状态。ethCall方法返回的是包含函数执行结果的字节数组。

ethCall方法的参数包括：

Transaction对象：用于指定待执行的智能合约地址、函数名以及函数参数等信息；
DefaultBlockParameter对象：用于指定查询的区块高度，如果不指定则默认为最新区块高度。
ethCall方法的使用场景包括：

查询智能合约状态：使用ethCall方法可以查询智能合约中的变量值或状态信息，而无需发送交易或改变智能合约状态；
执行智能合约函数：使用ethCall方法可以执行智能合约中的函数，查询函数执行结果并返回结果。
总之，ethCall方法是在以太坊网络上执行智能合约函数的重要方法，可以用于查询智能合约状态或执行函数，是区块链开发中不可或缺的工具之一。

### Transaction.createEthCallTransaction(fromAddr, contractAddress, data)

Transaction.createEthCallTransaction是Web3.js中的一个方法，用于创建一个以太坊调用交易，它的用途是向以太坊网络发送一个只读的调用请求，该请求不会修改区块链状态，也不会消耗Gas。

通常，调用合约函数需要发送一个交易，该交易会修改区块链状态，并且需要支付一定数量的Gas作为交易费用。但是，有时候我们只需要查询合约函数的返回值，而不需要修改状态或消耗Gas，此时就可以使用createEthCallTransaction方法。

例如，我们可以使用createEthCallTransaction方法查询一个ERC20代币合约的余额，或者查询一个智能合约中某个状态变量的值等等。

总之，createEthCallTransaction方法是Web3.js中非常实用的一个方法，可以帮助我们快速查询合约函数的返回值，而不需要发送一个修改状态的交易。

## WalletUtils

WalletUtils 是 Web3j 项目中的一个类，用于处理以太坊钱包文件。该类提供了一些方法，使得用户能够轻松创建、加载、导入和导出以太坊钱包文件。

以下是 WalletUtils 中一些常用的方法：

1. generateFullNewWalletFile(String password, File destinationDirectory)：生成一个新的带有地址和私钥的钱包文件，并将其保存到指定的目录中。
2. loadCredentials(String password, File source)：从指定的钱包文件中读取信息，返回包含地址和私钥的凭证对象 Credentials。
3. generateBip39Seed(): 根据 BIP39 标准（确定性钱包）生成一个随机的助记词种子。
4. generateBip32MasterKey(byte[] seed)：根据给定的种子生成一个 BIP32 主密钥，用于从中派生其他密钥。
5. deriveBip32KeyPair(String extendedKey, int[] path)：从 BIP32 主密钥中按照指定路径派生一对公/私钥，用于在 HD 钱包中进行收发币操作。
6. generateWalletFile(String password, ECKeyPair ecKeyPair, File destinationDirectory)：通过给定的私钥对，生成一个新的钱包文件，并将其保存到指定的目录中。
7. encrypt(String password, String plaintext)：使用 AES 处理加密算法，用给定的密码加密传入的明文。
8. decrypt(String password, String ciphertext)：使用 AES 处理解密算法，用给定的密码解密传入的密文。

通过调用上述方法，用户可以非常方便地创建、加载、导入和导出以太坊钱包文件，以及处理相关的加密和解密任务。需要注意的是，在进行这些操作之前，用户应该仔细阅读有关 Web3j 和以太坊的官方文档，并确保在实际操作中严格遵循相关的安全措施。

## 参考

1. [区块链钱包开发（Android篇）](https://blog.csdn.net/starzhou/article/details/94197704)；

## [区块链-密码、私钥、keystore与助记词之间的爱恨情仇](https://zhuanlan.zhihu.com/p/48280194)

但是Keystore必须配合钱包密码才能使用该账号，所以只有Keystore文件，并不能掌控账号。对于助记词和私钥就不一样了，只要知道助记词或者私钥就能掌控该账号了。

[助记词钱包还有一个好处是](https://zhuanlan.zhihu.com/p/81764010)，一组助记词可以派生出N个私钥，每个私钥都可以对应一个**币种。如果你有30个币种（BTC、ETH**、LTC、EOS等等等等），你不需要每个币种都单独记录一下私钥，只需记录好一组助记词就可以掌控所有资产。

绝大多数情况都是因为明明是要导入钱包，而用户选择的却是「创建钱包」，创建出来的新地址自然是没有任何资产的。

助记词混淆的结果就是：你导入的助记词虽然都是对的，但资产可能对不上。如果这组助记词对应的正好是一个空钱包地址，你的资产自然就「归零」了。

## 私钥导入的钱包，不能备份助记词了，助记词只能备份一次

## 总结，对于以太坊钱包的理解，钱包开发的步骤，参考wide/CC-wallet

1. 需要具备钱包的创建和导入的功能；
   1. 这里是根据一系列复杂的算法计算生成私钥，然后生成助记词，这里的信息综合到一起会生成一个keystore；
   2. 钱包需要给用户展示助记词，然后进行校验，方便用户记录；
   3. 钱包导入，只需要私钥就可以了，私钥是资产的唯一凭证，丢了就真的没了；
   4. 私钥与助记词对等；
2. 钱包会展示常见币种的价格，包括cn和usd；
   1. 这个时候是通过公网的网站，调用通用的接口查询的，谁都可以查询；
   2. 但是自己的一些特殊的币种，可能就没收录，需要自己进行特殊处理；
3. 钱包的转出交易；
   1. 钱包转出，需要设置交易的个数、交易的手续费，这里的交易手续费决定了费用使用完成是否能记录交易，这里的交易费用就是消耗用的。可能会出现交易费用用完了，但是交易不成功的情况；
   2. 交易也是调用通用的接口进行的，用于将交易记录到网上，通过各种节点进行。在节点不够用的时候，可能还需要自己创建节点（需要消耗服务器资源）；
   3. 交易的记录，[可以查询一些网站](https://testnet.bscscan.com/address/0x9a62272fe2e8f30653bb5ac2c04f702474ac4882)；
      1. [交易当次的详细信息也可以查询到](https://testnet.bscscan.com/tx/0x4d245ff748c608eb27eefe8f44e5249f12e34d7ce79472518f5a384ce1829a8a)，会记录当次的转入转出地址，转账的时间，转账的费用等；
4. 区块链浏览器，Dapp；
   1. 用于进行一些额外的创收服务的，会在上边开发各种功能，比如游戏等；
   2. 需要自己接入各种dapp，嵌入dapp到自己的app中；
      1. dapp的交易需要依赖本地钱包的私钥进行，所以需要调用本地的服务；
5. 个人中心这些，主要用于修改一些设置，记录一些自己的操作等；
   1. 这些信息都是被存在本地的，删除之后啥都没了；
