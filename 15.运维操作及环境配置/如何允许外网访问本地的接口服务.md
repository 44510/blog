# 如何允许外网访问本地的接口服务

主要用在处理，三方服务回调我们的服务的时候的处理，麻烦点在于开发时候的 ip 访问形式。

<https://www.baidu.com/s?wd=%E5%A6%82%E4%BD%95%E5%85%81%E8%AE%B8%E5%A4%96%E7%BD%91%E8%AE%BF%E9%97%AE%E6%9C%AC%E5%9C%B0%E7%9A%84%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1&rsv_spt=1&rsv_iqid=0xed465983000b6ef3&issp=1&f=8&rsv_bp=1&rsv_idx=2&ie=utf-8&rqlang=cn&tn=baiduhome_pg&rsv_dl=tb&rsv_enter=1&rsv_btype=t&rsv_t=6094e1L3QavAxng0GaMHz6FQh9uKmo65DgjlZ86ZzkI7feP3Nv%2FjkoI7QJ8&oq=%25E8%258E%25B7%25E5%258F%2596%25E6%258C%2587%25E5%25AE%259Aip%25E7%259A%2584mac%25E5%259C%25B0%25E5%259D%2580&rsv_pq=a1c29dd00011a27b&inputT=941&rsv_sug3=3&rsv_sug1=2&rsv_sug7=100&rsv_sug2=0&rsv_sug4=941>

## 路由器 ip

36.22.242.167

## 端口映射

目前很多网站开发者安装了 IIS 或者 Apache 等 Web 服务器，可以把自己电脑配置成一以路由为中心的内网服务器。

本地服务器在内网测试是绰绰有余的，但是有些项目需要演示给异地的客户验收，而又赶不及把自己的网站放到服务器上面，这时我们就可以采用端口映射，让客户可以在外网访问我们的本地服务器(适合大部分的网站设计 Soho 工作者)。网络上面已经有很多软件可以实现这一功能，但是我今天要讲的是不依靠任何软件（本人不喜欢安装软件），而是自己设置路由的端口，达到自己电脑上面的本地服务器能被外网访问。什么是端口映射，下面会有介绍，在搞这个端口映射的前提，是要有一个路由，没路由的，麻烦…..你去买一个吧。

我们的本地 Web 服务器一般都是 Http://localhost/ 或者后面带端口，局域网的用户则是通过电脑的内网 IP 访问 Web 服务器，例如，Web 服务器电脑的 IP 是 192.168.1.112，局域网内的其他用户则可以通过 https://192.168.1.112访问到我们的Web服务器，但是对于外网用户来说，不可能通过访问https://192.168.1.112这个IP来访问我们的Web服务器，那就需要一个对于外网用户而言你的Web服务器是唯一的IP地址，起这个唯一IP地址作用的就是你的路由。 下面我就以 TP-Link 路由为例子，介绍端口映射怎么操作。

一、我们进入路由器，查看我们的路由的 WAN 口的 IP 地址。 Wan 口这个 IP（27.40.127.248）就是外网用户可以唯一识别你电脑地址的路由 IP，但是一个路由一般都同时连接着几部电脑，这又怎么让访问者找到你呢，这就需要到了端口映射。端口映射又称端口转发。端口映射过程就如同你家在一个小区里 T 栋 112 室，你朋友来找你，找到小区门口，不知道你住哪层哪号？就问小区的保安，保安就告诉了他你家详细门牌号，这样你朋友很轻松的找到了你家。这个保安就是就路由器，这个过程就是外网访问内网通过端口映射的形象比喻。

然后我们再在 TP-Link 路由里面找到它的端口映射功能，这个端口映射所在位置是“转发规则”里面的“虚拟服务器”（每个牌子的路由的名字都不一样，请大家自己详细找找），然后添加转发条目，如下图：虚拟服务 80 端口转发在我的 TP-Link 下面，我已经添加了两条条目，就分别是 80 端口和 8080 端口的转发到内网 192.168.1.112 在台电脑，现在只要用户通过 80 或者 8080 这两个端口访问路由的 IP，那路由就会把用户转向 192.168.1.112 这台电脑所在本地服务器。端口映射除了 Web 服务器可以做这样的设置，FTP 也可以做类似的转发，FTP 的默认端口是 21。

## 内网穿透<使用内网穿透实现外网访问本地接口>

## A

这个问题的本质是，路由器只有一个 ip，也就是说公司只有一个 ip，需要确认接口访问到的地址的准确局域网的电脑与 ip，所以基本意思就是要做一个映射，从路由器的访问端口映射到局域网内自己主机的端口。

`http://36.22.242.167:7001/` (转发到局域网内的)=> `http://192.168.31.234:7001/`
